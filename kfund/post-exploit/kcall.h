//
//  kcall.h
//  kfund
//
//  Created by Seo Hyun-gyu on 1/2/24.
//

#include <mach/mach.h>
#include <Foundation/Foundation.h>

typedef mach_port_t io_object_t;
typedef mach_port_t io_connect_t;
typedef io_object_t io_service_t, io_connect_t, io_registry_entry_t;
extern const mach_port_t kIOMasterPortDefault;

#define IO_OBJECT_NULL ((io_object_t)0)

io_service_t IOServiceGetMatchingService(mach_port_t, CFDictionaryRef);
CFMutableDictionaryRef IOServiceMatching(const char *);
kern_return_t IOServiceOpen(io_service_t, task_port_t, uint32_t, io_connect_t *);
kern_return_t IOObjectRelease(io_object_t);
kern_return_t IOConnectTrap6(io_connect_t, uint32_t, uintptr_t, uintptr_t, uintptr_t, uintptr_t, uintptr_t, uintptr_t);
kern_return_t IOServiceClose(io_connect_t);

uint64_t kcall(uint64_t addr, uint64_t x0, uint64_t x1, uint64_t x2, uint64_t x3, uint64_t x4, uint64_t x5, uint64_t x6);
uint64_t kalloc(size_t ksize);
void kfree(uint64_t kaddr, size_t ksize);

int prepare_kcall(void);
int term_kcall(void);
uint64_t kvtophys(uint64_t kvaddr);
uint64_t physread64(uint64_t pa);
void physwrite64(uint64_t paddr, uint64_t value);
