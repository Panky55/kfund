//
//  trustcache.h
//  kfund
//
//  Created by Seo Hyun-gyu on 1/3/24.
//

#ifndef trustcache_h
#define trustcache_h

#define CS_CDHASH_LEN 20

typedef struct sTrustcache_entry
{
    uint8_t hash[CS_CDHASH_LEN];
    uint8_t hash_type;
    uint8_t flags;
} __attribute__((__packed__)) trustcache_entry;

typedef struct sTrustcache_file
{
    uint32_t version;
    uuid_t uuid;
    uint32_t length;
    trustcache_entry entries[];
} __attribute__((__packed__)) trustcache_file;

typedef struct sTrustcache_page
{
    uint64_t nextPtr;
    uint64_t selfPtr;
    trustcache_file file;
} __attribute__((__packed__)) trustcache_page;

BOOL trustCacheListAdd(uint64_t trustCacheKaddr);
BOOL trustCacheListRemove(uint64_t trustCacheKaddr);
uint64_t staticTrustCacheUploadFile(trustcache_file *fileToUpload, size_t fileSize, size_t *outMapSize);
uint64_t staticTrustCacheUploadFileAtPath(NSString *filePath, size_t *outMapSize);

#endif /* trustcache_h */
